<!doctype html>
<!-- EIA.gov API -->
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>c-trl by c-trl</title>

    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="shortcut icon" href="http://bobdawg.org/images/ico/Link_Vista.ico">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
      
      
        <center><h1><a href="/home"><img src="http://i.imgur.com/9673XO4.png" class="home" height=120px width=120px></a></h1></center>
        <hr>
        <h3><a id="eia" class="anchor" href="#eia" aria-hidden="true"><span class="octicon octicon-link"></span></a>Working with the EIA.gov API</h3>
        <p><a href="/energy">Section I: Getting to Know the API, Configuration and Setup</a></p>
        <p><a href="/energy/p2">Section II: Aggregating EIA Data with Python</a></p>
        <p><a href="/energy/p3">Section III: Cleaning, Visualization with Pandas, Matplotlib</a></p>
        <p><a href="/energy/p4">Section IV: Understanding SVG Files with BeautifulSoup</a></p>
        <p><a href="/energy/p5">Section V: Geoplotting State-Level US Data to Create Heatmaps</a></p>

      </header>
      <section>
        <h3>
<a id="eia" class="anchor" href="#eia" aria-hidden="true"><span class="octicon octicon-link"></span></a>Collecting Data on Energy</h3>

<p>The U.S. Energy Information Administration has a <a class="reference" href="http://http://www.eia.gov/">great website</a> and is a go-to resource for anything energy data-related.  The site has gone through a number of design changes, and provides a great GUI tool to explore various datasets, however to really dig into historical data, it's easier to bring data in from the back.  Luckily, EIA has developed an API to allow for easy access to historical data with Python.  </p>

<h3>
<a class="blog-section" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting Up</h3>



<!-- search_keywords() -->

<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">searches <span style="color: #666666">=</span> {}

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">search_keywords</span>():
    query <span style="color: #666666">=</span> <span style="color: #008000">raw_input</span>(<span style="color: #BA2121">&#39;Search for Keyword: &#39;</span>)
    <span style="color: #008000; font-weight: bold">if</span> query <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;x&#39;</span> <span style="color: #AA22FF; font-weight: bold">or</span> query <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;q&#39;</span>:
        <span style="color: #008000; font-weight: bold">pass</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        base_url <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;http://api.eia.gov/search/?search_term=name&amp;search_value=&quot;{}&quot;&amp;rows_per_page={}&#39;</span>
        r <span style="color: #666666">=</span> requests<span style="color: #666666">.</span>get(base_url<span style="color: #666666">.</span>format(query, <span style="color: #BA2121">&#39;10000&#39;</span>))
        text <span style="color: #666666">=</span> r<span style="color: #666666">.</span>text
        master_dict <span style="color: #666666">=</span> json<span style="color: #666666">.</span>loads(text)
        m <span style="color: #666666">=</span> master_dict
        data <span style="color: #666666">=</span> m[<span style="color: #BA2121">&#39;response&#39;</span>]
        docs <span style="color: #666666">=</span> data[<span style="color: #BA2121">&#39;docs&#39;</span>]
        <span style="color: #008000; font-weight: bold">print</span>(<span style="color: #BA2121">&#39;Search Results Found:&#39;</span>)
        <span style="color: #008000; font-weight: bold">for</span> series <span style="color: #AA22FF; font-weight: bold">in</span> docs:
            <span style="color: #008000; font-weight: bold">print</span> {series[<span style="color: #BA2121">&#39;name&#39;</span>]:series[<span style="color: #BA2121">&#39;series_id&#39;</span>]}
</pre></div>



<!-- search results -->
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">Search <span style="color: #008000; font-weight: bold">for</span> Keyword: renewable energy
Search Results Found:
{<span style="color: #BA2121">u&#39;Renewable energy production, Iowa&#39;</span>: <span style="color: #BA2121">u&#39;SEDS.REPRB.IA.A&#39;</span>}
{<span style="color: #BA2121">u&#39;Renewable energy production, Ohio&#39;</span>: <span style="color: #BA2121">u&#39;SEDS.REPRB.OH.A&#39;</span>}
{<span style="color: #BA2121">u&#39;Renewable energy production, Utah&#39;</span>: <span style="color: #BA2121">u&#39;SEDS.REPRB.UT.A&#39;</span>}
{<span style="color: #BA2121">u&#39;Renewable energy production, Idaho&#39;</span>: <span style="color: #BA2121">u&#39;SEDS.REPRB.ID.A&#39;</span>}
{<span style="color: #BA2121">u&#39;Renewable energy production, Maine&#39;</span>: <span style="color: #BA2121">u&#39;SEDS.REPRB.ME.A&#39;</span>}
</pre></div>


<!-- search_series() -->
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">df_i <span style="color: #666666">=</span> {}

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">search_series</span>(query, save_as):
    base_url <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;http://api.eia.gov/search/?search_term=series_id&amp;search_value=&quot;{}&quot;&amp;rows_per_page={}&#39;</span>
    r <span style="color: #666666">=</span> requests<span style="color: #666666">.</span>get(base_url<span style="color: #666666">.</span>format(query, <span style="color: #BA2121">&#39;10000&#39;</span>))
    text <span style="color: #666666">=</span> r<span style="color: #666666">.</span>text
    master_dict <span style="color: #666666">=</span> json<span style="color: #666666">.</span>loads(text)
    m <span style="color: #666666">=</span> master_dict
    data <span style="color: #666666">=</span> m[<span style="color: #BA2121">&#39;response&#39;</span>]
    docs <span style="color: #666666">=</span> data[<span style="color: #BA2121">&#39;docs&#39;</span>]
    <span style="color: #008000; font-weight: bold">print</span>(<span style="color: #BA2121">&#39;Search Results Found:&#39;</span>)
    <span style="color: #008000; font-weight: bold">for</span> series <span style="color: #AA22FF; font-weight: bold">in</span> docs:
        <span style="color: #008000; font-weight: bold">print</span> {series[<span style="color: #BA2121">&#39;name&#39;</span>]:series[<span style="color: #BA2121">&#39;series_id&#39;</span>]}
    save_search <span style="color: #666666">=</span> <span style="color: #008000">raw_input</span>(<span style="color: #BA2121">&#39;Would you like to save these search results? &#39;</span>)
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #BA2121">&#39;y&#39;</span> <span style="color: #AA22FF; font-weight: bold">in</span> save_search<span style="color: #666666">.</span>lower():
        searches[save_as] <span style="color: #666666">=</span> docs
        series_index <span style="color: #666666">=</span> [{x[<span style="color: #BA2121">&#39;name&#39;</span>]<span style="color: #666666">.</span>split(<span style="color: #BA2121">&#39;, &#39;</span>)[<span style="color: #666666">1</span>] : x[<span style="color: #BA2121">&#39;series_id&#39;</span>]} <span style="color: #008000; font-weight: bold">for</span> x <span style="color: #AA22FF; font-weight: bold">in</span> searches[save_as]]
        df <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>DataFrame(series_index)
        df <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>DataFrame(df<span style="color: #666666">.</span>stack())
        df <span style="color: #666666">=</span> df<span style="color: #666666">.</span>reset_index()
        df <span style="color: #666666">=</span> df<span style="color: #666666">.</span>drop(<span style="color: #BA2121">&#39;level_0&#39;</span>, axis<span style="color: #666666">=1</span>)
        df_i[save_as] <span style="color: #666666">=</span> df<span style="color: #666666">.</span>rename(columns<span style="color: #666666">=</span>{<span style="color: #BA2121">&#39;level_1&#39;</span>:<span style="color: #BA2121">&#39;State&#39;</span>,<span style="color: #666666">0</span>:save_as})
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">pass</span>
</pre></div>




      </section>
      <footer>
        
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-50124410-3");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
